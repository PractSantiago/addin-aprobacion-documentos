/*! For license information please see taskpane.js.LICENSE.txt */
!function(){var e={58394:function(e,t,n){"use strict";e.exports=n.p+"f5a09422ee730da0375f.css"}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.m=e,n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=r[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),n.b="undefined"!=typeof document&&document.baseURI||self.location.href,function(){function e(){var n,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function c(e,o,a,i){var c=o&&o.prototype instanceof s?o:s,u=Object.create(c.prototype);return t(u,"_invoke",function(e,t,o){var a,i,c,s=0,u=o||[],l=!1,f={p:0,n:0,v:n,a:m,f:m.bind(n,4),d:function(e,t){return a=e,i=0,c=n,f.n=t,d}};function m(e,t){for(i=e,c=t,r=0;!l&&s&&!o&&r<u.length;r++){var o,a=u[r],m=f.p,p=a[2];e>3?(o=p===t)&&(c=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=n):a[0]<=m&&((o=e<2&&m<a[1])?(i=0,f.v=t,f.n=a[1]):m<p&&(o=e<3||a[0]>t||t>p)&&(a[4]=e,a[5]=t,f.n=p,i=0))}if(o||e>1)return d;throw l=!0,t}return function(o,u,p){if(s>1)throw TypeError("Generator is already running");for(l&&1===u&&m(u,p),i=u,c=p;(r=i<2?n:c)||!l;){a||(i?i<3?(i>1&&(f.n=-1),m(i,c)):f.n=c:f.v=c);try{if(s=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,c)))throw TypeError("iterator result is not an object");if(!r.done)return r;c=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=n}else if((r=(l=f.n<0)?c:e.call(t,f))!==d)break}catch(e){a=n,i=1,c=e}finally{s=1}}return{value:r,done:l}}}(e,a,i),!0),u}var d={};function s(){}function u(){}function l(){}r=Object.getPrototypeOf;var f=[][a]?r(r([][a]())):(t(r={},a,function(){return this}),r),m=l.prototype=s.prototype=Object.create(f);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,t(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return u.prototype=l,t(m,"constructor",l),t(l,"constructor",u),u.displayName="GeneratorFunction",t(l,i,"GeneratorFunction"),t(m),t(m,i,"Generator"),t(m,a,function(){return this}),t(m,"toString",function(){return"[object Generator]"}),(e=function(){return{w:c,m:p}})()}function t(e,n,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}t=function(e,n,r,o){function i(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?a?a(e,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[n]=r:(i("next",0),i("throw",1),i("return",2))},t(e,n,r,o)}function n(e,t,n,r,o,a,i){try{var c=e[a](i),d=c.value}catch(e){return void n(e)}c.done?t(d):Promise.resolve(d).then(r,o)}function r(e){return function(){var t=this,r=arguments;return new Promise(function(o,a){var i=e.apply(t,r);function c(e){n(i,o,a,c,d,"next",e)}function d(e){n(i,o,a,c,d,"throw",e)}c(void 0)})}}var o={correoRevisor:"practica.sis4@spradling.group",correoFirmante:"practica.sis4@spradling.group",urlPowerAutomate:""},a="",i=null,c=null;function d(){try{!function(){try{a="practica.sis4@spradling.group",document.getElementById("nombre-usuario").textContent=a}catch(e){a="practica.sis4@spradling.group",document.getElementById("nombre-usuario").textContent=a}}(),e=document.getElementById("seccion-enviar"),t=document.getElementById("seccion-firmar"),n=a.toLowerCase()===o.correoRevisor.toLowerCase(),r=a.toLowerCase()===o.correoFirmante.toLowerCase(),n&&(e.style.display="block"),r&&(t.style.display="block"),n||r||w("No tienes permisos para usar este Add-in.","error"),document.getElementById("btn-enviar").addEventListener("click",s),document.getElementById("btn-firmar").addEventListener("click",l),document.getElementById("btn-seleccionar-archivo").addEventListener("click",function(){document.getElementById("input-firma").click()}),document.getElementById("input-firma").addEventListener("change",m),document.getElementById("btn-confirmar-firma").addEventListener("click",p),document.getElementById("btn-cambiar-firma").addEventListener("click",g),document.getElementById("btn-guardar-pdf").addEventListener("click",h),function(){try{var e=localStorage.getItem("firma_usuario");if(e&&e.length>100)return i=e,void console.log("Firma cargada desde localStorage");"undefined"!=typeof Office&&Office.context&&Office.context.document&&Office.context.document.settings.refreshAsync(function(e){if(e.status===Office.AsyncResultStatus.Succeeded){var t=Office.context.document.settings.get("firma_usuario");t&&(i=t)}})}catch(e){console.log("No hay firma guardada previamente")}}(),document.getElementById("loading").style.display="none",document.getElementById("contenido").style.display="block"}catch(e){document.getElementById("loading").innerHTML="<p style='color:red'>Error: "+e.message+"</p>"}var e,t,n,r}function s(){return u.apply(this,arguments)}function u(){return(u=r(e().m(function t(){var n,r;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:e.p=0,w("Enviando correo de aprobación...","info"),document.getElementById("btn-enviar").disabled=!0,n="Documento sin nombre",r="URL no disponible";try{"undefined"!=typeof Office&&Office.context&&Office.context.document&&Office.context.document.url&&(n=decodeURIComponent(Office.context.document.url.split("/").pop().split("?")[0]),r=Office.context.document.url)}catch(e){}if(o.urlPowerAutomate){e.n=1;break}return w("✅ [PRUEBA] Correo enviado a: "+o.correoFirmante+" | Documento: "+n,"exito"),document.getElementById("btn-enviar").disabled=!1,e.a(2);case 1:return e.n=2,fetch(o.urlPowerAutomate,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accion:"enviarAprobacion",nombreDocumento:n,urlDocumento:r,correoFirmante:o.correoFirmante,correoRevisor:o.correoRevisor})});case 2:if(!e.v.ok){e.n=3;break}w("✅ Correo enviado a "+o.correoFirmante,"exito"),e.n=4;break;case 3:throw new Error("Error al enviar el correo");case 4:e.n=6;break;case 5:e.p=5,w("❌ Error: "+e.v.message,"error");case 6:return e.p=6,document.getElementById("btn-enviar").disabled=!1,e.f(6);case 7:return e.a(2)}},t,null,[[0,5,6,7]])}))).apply(this,arguments)}function l(){return f.apply(this,arguments)}function f(){return(f=r(e().m(function t(){return e().w(function(e){for(;;)switch(e.n){case 0:if(!(i&&i.length>100)){e.n=2;break}return e.n=1,b(i);case 1:e.n=3;break;case 2:i=null,c=null,document.getElementById("input-firma").value="",document.getElementById("img-preview").src="",document.getElementById("preview-firma").style.display="none",document.getElementById("btn-seleccionar-archivo").style.display="block",document.getElementById("btn-firmar").style.display="none",document.getElementById("panel-firma").style.display="block",document.getElementById("mensaje").style.display="none";case 3:return e.a(2)}},t)}))).apply(this,arguments)}function m(e){var t=e.target.files[0];if(t)if(t.type.startsWith("image/"))if(t.size>2097152)w("❌ La imagen es muy grande. Máximo 2MB.","error");else{var n=new FileReader;n.onload=function(e){c=e.target.result,document.getElementById("img-preview").src=c,document.getElementById("preview-firma").style.display="block",document.getElementById("btn-seleccionar-archivo").style.display="none",w("Imagen cargada. Confirma para firmar el documento.","info")},n.readAsDataURL(t)}else w("❌ Por favor selecciona un archivo de imagen (PNG, JPG, GIF).","error")}function p(){return y.apply(this,arguments)}function y(){return(y=r(e().m(function t(){return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(c){e.n=1;break}return w("❌ No hay imagen de firma seleccionada.","error"),e.a(2);case 1:e.p=1;try{localStorage.setItem("firma_usuario",c)}catch(e){}if(e.p=2,"undefined"==typeof Office||!Office.context||!Office.context.document){e.n=3;break}return Office.context.document.settings.set("firma_usuario",c),e.n=3,I();case 3:e.n=5;break;case 4:e.p=4,e.v,console.log("Office settings no disponible, usando localStorage");case 5:return i=c,e.n=6,b(i);case 6:e.n=8;break;case 7:e.p=7,w("❌ Error al confirmar firma: "+e.v.message,"error");case 8:return e.a(2)}},t,null,[[2,4],[1,7]])}))).apply(this,arguments)}function g(){c=null,document.getElementById("preview-firma").style.display="none",document.getElementById("btn-seleccionar-archivo").style.display="block",document.getElementById("input-firma").value="",document.getElementById("img-preview").src="",document.getElementById("mensaje").style.display="none"}function b(e){return v.apply(this,arguments)}function v(){return v=r(e().m(function t(n){var o;return e().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,w("Aplicando firma al documento...","info"),"undefined"!=typeof Word){t.n=1;break}return document.getElementById("panel-firma").style.display="block",document.getElementById("btn-seleccionar-archivo").style.display="none",document.getElementById("preview-firma").style.display="block",document.getElementById("img-preview").src=n,document.getElementById("btn-confirmar-firma").style.display="none",document.getElementById("btn-cambiar-firma").style.display="none",document.getElementById("btn-firmar").style.display="none",w("⚠️ Word API no disponible. Usa Word de escritorio para firmar.","info"),t.a(2);case 1:return t.n=2,Word.run(function(){var t=r(e().m(function t(r){var o,i,c,d,s;return e().w(function(e){for(;;)switch(e.n){case 0:return(o=r.document.body).insertBreak(Word.BreakType.page,Word.InsertLocation.end),(i=o.insertParagraph("Firma",Word.InsertLocation.end)).styleBuiltIn=Word.Style.heading1,i.alignment=Word.Alignment.centered,(c=o.insertParagraph("",Word.InsertLocation.end)).alignment=Word.Alignment.centered,d=n.replace(/^data:image\/(png|jpeg|jpg|gif);base64,/,""),c.insertInlinePictureFromBase64(d,Word.InsertLocation.end),(s=o.insertParagraph("Firmado por: "+a+"\nFecha: "+(new Date).toLocaleDateString("es-ES")+" "+(new Date).toLocaleTimeString("es-ES"),Word.InsertLocation.end)).alignment=Word.Alignment.centered,s.font.size=10,s.font.color="#666666",e.n=1,r.sync();case 1:return e.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}());case 2:document.getElementById("panel-firma").style.display="none",document.getElementById("btn-firmar").style.display="none",document.getElementById("seccion-guardar-pdf").style.display="block",w("✅ Documento firmado exitosamente.","exito"),t.n=4;break;case 3:t.p=3,w("❌ Error al aplicar la firma: "+(o=t.v).message,"error"),console.error("Error detallado:",o);case 4:return t.a(2)}},t,null,[[0,3]])})),v.apply(this,arguments)}function h(){return E.apply(this,arguments)}function E(){return(E=r(e().m(function t(){return e().w(function(e){for(;;)switch(e.n){case 0:try{w("Generando PDF...","info"),document.getElementById("btn-guardar-pdf").disabled=!0,Office.context.document.getFileAsync(Office.FileType.Pdf,function(e){if(e.status===Office.AsyncResultStatus.Succeeded){var t=e.value,n=t.sliceCount,r=[],o=0,a=function(e){t.getSliceAsync(e,function(i){if(i.status===Office.AsyncResultStatus.Succeeded)if(r[e]=i.value.data,++o===n){t.closeAsync();for(var c=[],d=0;d<r.length;d++)c.push(r[d]);var s=new Blob(c,{type:"application/pdf"}),u="documento-firmado.pdf";try{if(Office.context.document.url){var l=Office.context.document.url.split("/");u=decodeURIComponent(l[l.length-1]).split("?")[0].replace(/\.[^/.]+$/,"")+" firmado.pdf"}}catch(e){}var f=window.URL.createObjectURL(s),m=document.createElement("a");m.href=f,m.download=u,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(f),w("✅ PDF descargado exitosamente en Descargas.","exito"),document.getElementById("btn-guardar-pdf").disabled=!1}else a(o);else t.closeAsync(),w("❌ Error al obtener slice del documento.","error"),document.getElementById("btn-guardar-pdf").disabled=!1})};a(0)}else w("❌ No se pudo obtener el archivo: "+e.error.message,"error"),document.getElementById("btn-guardar-pdf").disabled=!1})}catch(e){w("❌ Error al generar PDF: "+e.message,"error"),document.getElementById("btn-guardar-pdf").disabled=!1,console.error("Error detallado:",e)}case 1:return e.a(2)}},t)}))).apply(this,arguments)}function I(){return new Promise(function(e,t){Office.context.document.settings.saveAsync(function(n){n.status===Office.AsyncResultStatus.Succeeded?e():t(new Error("Error al guardar configuración"))})})}function w(e,t){var n=document.getElementById("mensaje");n.textContent=e,n.className=t,n.style.display="block"}"complete"===document.readyState||"interactive"===document.readyState?setTimeout(d,500):document.addEventListener("DOMContentLoaded",d)}(),function(){"use strict";new URL(n(58394),n.b)}()}();
//# sourceMappingURL=taskpane.js.map