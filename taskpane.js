/*! For license information please see taskpane.js.LICENSE.txt */
!function(){var e={58394:function(e,n,t){"use strict";e.exports=t.p+"f5a09422ee730da0375f.css"}},n={};function t(r){var o=n[r];if(void 0!==o)return o.exports;var a=n[r]={exports:{}};return e[r](a,a.exports,t),a.exports}t.m=e,t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},function(){var e;t.g.importScripts&&(e=t.g.location+"");var n=t.g.document;if(!e&&n&&(n.currentScript&&"SCRIPT"===n.currentScript.tagName.toUpperCase()&&(e=n.currentScript.src),!e)){var r=n.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=r[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e}(),t.b="undefined"!=typeof document&&document.baseURI||self.location.href,function(){function e(){var t,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function c(e,o,a,i){var c=o&&o.prototype instanceof s?o:s,l=Object.create(c.prototype);return n(l,"_invoke",function(e,n,o){var a,i,c,s=0,l=o||[],d=!1,f={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,n){return a=e,i=0,c=t,f.n=n,u}};function m(e,n){for(i=e,c=n,r=0;!d&&s&&!o&&r<l.length;r++){var o,a=l[r],m=f.p,p=a[2];e>3?(o=p===n)&&(c=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=m&&((o=e<2&&m<a[1])?(i=0,f.v=n,f.n=a[1]):m<p&&(o=e<3||a[0]>n||n>p)&&(a[4]=e,a[5]=n,f.n=p,i=0))}if(o||e>1)return u;throw d=!0,n}return function(o,l,p){if(s>1)throw TypeError("Generator is already running");for(d&&1===l&&m(l,p),i=l,c=p;(r=i<2?t:c)||!d;){a||(i?i<3?(i>1&&(f.n=-1),m(i,c)):f.n=c:f.v=c);try{if(s=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,c)))throw TypeError("iterator result is not an object");if(!r.done)return r;c=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=t}else if((r=(d=f.n<0)?c:e.call(n,f))!==u)break}catch(e){a=t,i=1,c=e}finally{s=1}}return{value:r,done:d}}}(e,a,i),!0),l}var u={};function s(){}function l(){}function d(){}r=Object.getPrototypeOf;var f=[][a]?r(r([][a]())):(n(r={},a,function(){return this}),r),m=d.prototype=s.prototype=Object.create(f);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,n(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return l.prototype=d,n(m,"constructor",d),n(d,"constructor",l),l.displayName="GeneratorFunction",n(d,i,"GeneratorFunction"),n(m),n(m,i,"Generator"),n(m,a,function(){return this}),n(m,"toString",function(){return"[object Generator]"}),(e=function(){return{w:c,m:p}})()}function n(e,t,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}n=function(e,t,r,o){function i(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},n(e,t,r,o)}function t(e,n,t,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void t(e)}c.done?n(u):Promise.resolve(u).then(r,o)}function r(e){return function(){var n=this,r=arguments;return new Promise(function(o,a){var i=e.apply(n,r);function c(e){t(i,o,a,c,u,"next",e)}function u(e){t(i,o,a,c,u,"throw",e)}c(void 0)})}}var o={correoRevisor:"practica.sis1@spradling.group",correoFirmante:"practica.sis4@spradling.group",urlPowerAutomate:""},a="",i=null,c=null;function u(){return(u=r(e().m(function n(){var t;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,s();case 1:d(),f(),k(),document.getElementById("loading").style.display="none",document.getElementById("contenido").style.display="block",e.n=3;break;case 2:e.p=2,t=e.v,document.getElementById("loading").innerHTML="<p style='color:red'>Error: "+t.message+"</p>";case 3:return e.a(2)}},n,null,[[0,2]])}))).apply(this,arguments)}function s(){return l.apply(this,arguments)}function l(){return(l=r(e().m(function n(){var t,r,o;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,"undefined"==typeof Office||!Office.context||!Office.context.auth){e.n=5;break}return e.p=1,e.n=2,new Promise(function(e,n){Office.context.auth.getAccessTokenAsync({allowSignInPrompt:!1},function(t){if(t.status===Office.AsyncResultStatus.Succeeded)try{var r=t.value.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=JSON.parse(window.atob(r)),i=o.preferred_username||o.upn||o.email||o.unique_name;if(i)return a=i.toLowerCase(),document.getElementById("nombre-usuario").textContent=a,console.log("Usuario obtenido desde SSO:",a),void e()}catch(e){console.log("Error decodificando token:",e)}n()})});case 2:if(!a){e.n=3;break}return d(),e.a(2);case 3:e.n=5;break;case 4:e.p=4,r=e.v,console.log("SSO no disponible:",r);case 5:if(!Office.context.mailbox||!Office.context.mailbox.userProfile){e.n=6;break}return a=Office.context.mailbox.userProfile.emailAddress.toLowerCase(),document.getElementById("nombre-usuario").textContent=a,console.log("Usuario obtenido desde mailbox:",a),d(),e.a(2);case 6:if(!Office.context.roamingSettings){e.n=7;break}if(!(t=Office.context.roamingSettings.get("userEmail"))){e.n=7;break}return a=t.toLowerCase(),document.getElementById("nombre-usuario").textContent=a,console.log("Usuario obtenido desde roamingSettings:",a),d(),e.a(2);case 7:a="practica.sis4@spradling.group",document.getElementById("nombre-usuario").textContent=a+" (modo prueba)",console.log("⚠️ No se pudo obtener correo. Usando valor por defecto."),e.n=9;break;case 8:e.p=8,o=e.v,a="practica.sis4@spradling.group",document.getElementById("nombre-usuario").textContent=a+" (modo prueba)",console.log("Error obteniendo usuario:",o);case 9:return e.a(2)}},n,null,[[1,4],[0,8]])}))).apply(this,arguments)}function d(){var e=document.getElementById("seccion-enviar"),n=document.getElementById("seccion-firmar"),t=a.toLowerCase()===o.correoRevisor.toLowerCase(),r=a.toLowerCase()===o.correoFirmante.toLowerCase();t&&(e.style.display="block"),r&&(n.style.display="block"),t||r||x("No tienes permisos para usar este Add-in.","error")}function f(){document.getElementById("btn-enviar").addEventListener("click",m),document.getElementById("btn-firmar").addEventListener("click",y),document.getElementById("btn-seleccionar-archivo").addEventListener("click",function(){document.getElementById("input-firma").click()}),document.getElementById("input-firma").addEventListener("change",b),document.getElementById("btn-confirmar-firma").addEventListener("click",v),document.getElementById("btn-cambiar-firma").addEventListener("click",E),document.getElementById("btn-guardar-pdf").addEventListener("click",B)}function m(){return p.apply(this,arguments)}function p(){return(p=r(e().m(function n(){var t,r;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:e.p=0,x("Enviando correo de aprobación...","info"),document.getElementById("btn-enviar").disabled=!0,t="Documento sin nombre",r="URL no disponible";try{"undefined"!=typeof Office&&Office.context&&Office.context.document&&Office.context.document.url&&(t=decodeURIComponent(Office.context.document.url.split("/").pop().split("?")[0]),r=Office.context.document.url)}catch(e){}if(o.urlPowerAutomate){e.n=1;break}return x("✅ [PRUEBA] Correo enviado a: "+o.correoFirmante+" | Documento: "+t,"exito"),document.getElementById("btn-enviar").disabled=!1,e.a(2);case 1:return e.n=2,fetch(o.urlPowerAutomate,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accion:"enviarAprobacion",nombreDocumento:t,urlDocumento:r,correoFirmante:o.correoFirmante,correoRevisor:o.correoRevisor})});case 2:if(!e.v.ok){e.n=3;break}x("✅ Correo enviado a "+o.correoFirmante,"exito"),e.n=4;break;case 3:throw new Error("Error al enviar el correo");case 4:e.n=6;break;case 5:e.p=5,x("❌ Error: "+e.v.message,"error");case 6:return e.p=6,document.getElementById("btn-enviar").disabled=!1,e.f(6);case 7:return e.a(2)}},n,null,[[0,5,6,7]])}))).apply(this,arguments)}function y(){return g.apply(this,arguments)}function g(){return(g=r(e().m(function n(){return e().w(function(e){for(;;)switch(e.n){case 0:if(!(i&&i.length>100)){e.n=2;break}return e.n=1,w(i);case 1:e.n=3;break;case 2:i=null,c=null,document.getElementById("input-firma").value="",document.getElementById("img-preview").src="",document.getElementById("preview-firma").style.display="none",document.getElementById("btn-seleccionar-archivo").style.display="block",document.getElementById("btn-firmar").style.display="none",document.getElementById("panel-firma").style.display="block",document.getElementById("mensaje").style.display="none";case 3:return e.a(2)}},n)}))).apply(this,arguments)}function b(e){var n=e.target.files[0];if(n)if(n.type.startsWith("image/"))if(n.size>2097152)x("❌ La imagen es muy grande. Máximo 2MB.","error");else{var t=new FileReader;t.onload=function(e){c=e.target.result,document.getElementById("img-preview").src=c,document.getElementById("preview-firma").style.display="block",document.getElementById("btn-seleccionar-archivo").style.display="none",x("Imagen cargada. Confirma para firmar el documento.","info")},t.readAsDataURL(n)}else x("❌ Por favor selecciona un archivo de imagen (PNG, JPG, GIF).","error")}function v(){return h.apply(this,arguments)}function h(){return(h=r(e().m(function n(){return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(c){e.n=1;break}return x("❌ No hay imagen de firma seleccionada.","error"),e.a(2);case 1:return e.p=1,localStorage.setItem("firma_usuario",c),console.log("Firma guardada en localStorage"),i=c,e.n=2,w(i);case 2:e.n=4;break;case 3:e.p=3,x("❌ Error al confirmar firma: "+e.v.message,"error");case 4:return e.a(2)}},n,null,[[1,3]])}))).apply(this,arguments)}function E(){c=null,document.getElementById("preview-firma").style.display="none",document.getElementById("btn-seleccionar-archivo").style.display="block",document.getElementById("input-firma").value="",document.getElementById("img-preview").src="",document.getElementById("mensaje").style.display="none"}function w(e){return I.apply(this,arguments)}function I(){return I=r(e().m(function n(t){var o;return e().w(function(n){for(;;)switch(n.p=n.n){case 0:if(n.p=0,x("Aplicando firma al documento...","info"),"undefined"!=typeof Word&&Word.run){n.n=1;break}return x("⚠️ Word API no disponible. Usa Word de escritorio para firmar.","info"),n.a(2);case 1:return n.n=2,Word.run(function(){var n=r(e().m(function n(r){var o,i,c,u,s;return e().w(function(e){for(;;)switch(e.n){case 0:return(o=r.document.body).insertBreak(Word.BreakType.page,Word.InsertLocation.end),(i=o.insertParagraph("Firma",Word.InsertLocation.end)).styleBuiltIn=Word.Style.heading1,i.alignment=Word.Alignment.centered,(c=o.insertParagraph("",Word.InsertLocation.end)).alignment=Word.Alignment.centered,u=t.replace(/^data:image\/(png|jpeg|jpg|gif);base64,/,""),c.insertInlinePictureFromBase64(u,Word.InsertLocation.end),(s=o.insertParagraph("Firmado por: "+a+"\nFecha: "+(new Date).toLocaleDateString("es-ES")+" "+(new Date).toLocaleTimeString("es-ES"),Word.InsertLocation.end)).alignment=Word.Alignment.centered,s.font.size=10,s.font.color="#666666",e.n=1,r.sync();case 1:return e.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}());case 2:document.getElementById("panel-firma").style.display="none",document.getElementById("btn-firmar").style.display="none",document.getElementById("seccion-guardar-pdf").style.display="block",x("✅ Documento firmado exitosamente.","exito"),n.n=4;break;case 3:n.p=3,x("❌ Error al aplicar la firma: "+(o=n.v).message,"error"),console.error("Error detallado:",o);case 4:return n.a(2)}},n,null,[[0,3]])})),I.apply(this,arguments)}function B(){return O.apply(this,arguments)}function O(){return O=r(e().m(function n(){return e().w(function(n){for(;;)switch(n.p=n.n){case 0:if(n.p=0,Office.context.platform!==Office.PlatformType.OfficeOnline){n.n=1;break}return x("ℹ️ En Word Online: Ve a Archivo → Guardar como → Descargar una copia → PDF para descargar el documento firmado.","info"),document.getElementById("btn-guardar-pdf").disabled=!1,n.a(2);case 1:x("Generando PDF...","info"),document.getElementById("btn-guardar-pdf").disabled=!0,Word.run(function(){var n=r(e().m(function n(t){return e().w(function(e){for(;;)switch(e.n){case 0:return t.document.body.load("text"),e.n=1,t.sync();case 1:Office.context.document.getFileAsync(Office.FileType.Pdf,{sliceSize:65536},function(e){if(e.status===Office.AsyncResultStatus.Succeeded){var n=function(e,t){e.getSliceAsync(t,function(t){if(t.status===Office.AsyncResultStatus.Succeeded)if(o=o.concat(Array.from(new Uint8Array(t.value.data))),++a===r){e.closeAsync();var i=new Blob([new Uint8Array(o)],{type:"application/pdf"}),c="documento-firmado.pdf";try{if(Office.context.document.url){var u=Office.context.document.url.split("/");c=decodeURIComponent(u[u.length-1]).split("?")[0].replace(/\.[^/.]+$/,"")+"-firmado.pdf"}}catch(e){}var s=window.URL.createObjectURL(i),l=document.createElement("a");l.href=s,l.download=c,document.body.appendChild(l),l.click(),setTimeout(function(){document.body.removeChild(l),window.URL.revokeObjectURL(s)},100),x("✅ PDF descargado exitosamente.","exito"),document.getElementById("btn-guardar-pdf").disabled=!1}else n(e,a);else e.closeAsync(),x("❌ Error al generar PDF.","error"),document.getElementById("btn-guardar-pdf").disabled=!1})},t=e.value,r=t.sliceCount,o=[],a=0;n(t,0)}else x("❌ No se pudo generar el PDF: "+e.error.message,"error"),document.getElementById("btn-guardar-pdf").disabled=!1});case 2:return e.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}()),n.n=3;break;case 2:n.p=2,x("❌ Error al generar PDF: "+n.v.message,"error"),document.getElementById("btn-guardar-pdf").disabled=!1;case 3:return n.a(2)}},n,null,[[0,2]])})),O.apply(this,arguments)}function k(){try{var e=localStorage.getItem("firma_usuario");e&&e.length>100&&(i=e,console.log("Firma cargada desde localStorage"))}catch(e){console.log("No hay firma guardada previamente")}}function x(e,n){var t=document.getElementById("mensaje");t.textContent=e,t.className=n,t.style.display="block"}Office.onReady(function(e){e.host===Office.HostType.Word&&(console.log("Office listo en Word"),function(){u.apply(this,arguments)}())})}(),function(){"use strict";new URL(t(58394),t.b)}()}();
//# sourceMappingURL=taskpane.js.map